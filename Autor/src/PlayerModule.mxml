<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical"
	width="800" height="512" creationComplete="init()" horizontalAlign="center" currentState="1">
	
	<mx:states>
		<mx:State name="1"/>
		<mx:State name="2">
			<mx:SetProperty target="{slideSpacer}" name="height" value="140"/>
			<mx:SetStyle target="{titleTextInput}" name="fontSize" value="32"/>
			<mx:SetStyle target="{bodyTextArea}" name="fontSize" value="28"/>
		</mx:State>
		<mx:State name="3">
			<mx:RemoveChild target="{slideSpacer}"/>
			<mx:RemoveChild target="{titleCanvas}"/>
			<mx:RemoveChild target="{bodyTextArea}"/>
			<mx:AddChild relativeTo="{slideVBox}" position="lastChild">
				<mx:Image id="slideImage" source="http://www.educar.tv/amf/services/autor/presentationfiles/{presentationID}/{slideVO.text_body}"/>
			</mx:AddChild>
			<mx:SetStyle target="{slideVBox}" name="verticalAlign" value="middle"/>
		</mx:State>
	</mx:states>
	
	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import br.com.optimedia.assets.vo.SlideVO;
			import br.com.optimedia.assets.ImgAssets;
			import mx.controls.Alert;
			import br.com.optimedia.player.PlayerFacade;
			
			public static const PLAYER_MODE:String = "PLAYER_MODE";
			public static const PREVIEW_MODE:String = "PREVIEW_MODE";
			
			private var playerFacade:PlayerFacade = PlayerFacade.getInstance();
			
			[Bindable]
			public var presentationID:int;
			
			[Bindable]
			public var slideID:Number;
			
			[Bindable]
			public var mode:String;
			
			[Bindable]
			private var slideVO:SlideVO = new SlideVO();
			
			[Bindable]
			public var slidesArray:ArrayCollection = new ArrayCollection();
			
			public function setSlide(slideVO:SlideVO):void {
				slideID = slideVO.slide_id;
				
				//gambiarra pra evitar slides q estão sendo salvos com tipo 0
				if( slideVO.type_slide_id == 0 ) slideVO.type_slide_id = 2;
				//fim da gambiarra
				
				this.currentState = slideVO.type_slide_id.toString();
				
				this.slideVO = slideVO;
				
				this.indexBtn.label = slideVO.page_order+1+"/"+slidesArray.length.toString();
			}
			
			private function init():void {
				var titleBackground:Sprite = new Sprite ();
				titleBackground.graphics.lineStyle(1,0x000000);
				titleBackground.graphics.beginFill(0xFFFFFF,0.5);
				titleBackground.graphics.drawRoundRect(40,0,titleCanvas.width*0.9,titleCanvas.height ,20,20);
				titleBackground.graphics.endFill();
				titleCanvas.rawChildren.addChildAt(titleBackground, 0);
			}
			
			public function start(presentationID:int, slideID:int, mode:String = PLAYER_MODE ):void {
				
				this.presentationID = presentationID;
				this.slideID = slideID;
				this.mode = mode;
				
				if( mode != PLAYER_MODE && mode != PREVIEW_MODE ) {
					Alert.show( mode+" não é um modo válido.", "Erro");
				}
				else {
					playerFacade.startup( this );
				}
			}
		]]>
	</mx:Script>
	
	<mx:VBox id="slideVBox" width="100%" height="100%" horizontalAlign="center">
		
		<mx:Spacer id="slideSpacer" height="0"/>
		
		<mx:Canvas id="titleCanvas" width="100%" height="50">
			<mx:TextInput id="titleTextInput" verticalCenter="0" horizontalCenter="0" width="714" backgroundAlpha="0" borderThickness="0"
				borderStyle="none" fontSize="28" text="{slideVO.title}"/>
		</mx:Canvas>
		
		<mx:TextArea id="bodyTextArea" width="784" height="100%" fontSize="22" htmlText="{slideVO.text_body}"/>
		
	</mx:VBox>
	
	<mx:Canvas width="100%">
	
		<mx:Image source="{ImgAssets.playerTaskbar}" width="784" bottom="0" horizontalCenter="0"/>
		
		<mx:HBox width="784" height="30" bottom="0" verticalAlign="middle" paddingLeft="2" paddingRight="2" horizontalCenter="0">
			
			<mx:Button id="prevBtn" toolTip="Slide Anterior" icon="{ImgAssets.backArrow}"/>
			<mx:Button id="indexBtn" toolTip="Lista de slides" width="120"/>
			<mx:Button id="nextBtn" toolTip="Próximo slide" icon="{ImgAssets.nextArrow}"/>
			
			<mx:Spacer width="100" />
			
			<mx:HBox id="mediaBox"/>
				
			<mx:Spacer width="100%" />
			
			<mx:Button id="urlBtn" toolTip="Clique para ver a url deste slide" width="30"/>
			
		</mx:HBox>

	</mx:Canvas>
	
</mx:Module>
