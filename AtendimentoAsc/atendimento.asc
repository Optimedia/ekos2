/* *  SISTEMA: SALA DE ATENDIMENTO *  ABRIL DE 2011 	olá	esse é um teste	jbsadhsagh * */ //contUsers = 0;load("netservices.asc");startGateway = false;	application.onAppStart = function() {	application.allowDebug = true;		trace("\n:: Iniciando aplicação...");	application.usersSo = SharedObject.get("filaAtendimento", false);	application.nextId = 0;};setIniciaGateway = function (gateway) {	NetServices.setDefaultGatewayUrl(gateway);	this.cgwc = NetServices.createGatewayConnection();};application.onConnect = function(con, userName) {	trace("\n:: Usuario conectando... ID: " + userName);	if (startGateway == false) {		setIniciaGateway("http://10.1.1.10/amf/gateway.php");		startGateway = true;	}	con.id = "u" + application.nextId++;	con.name = userName;	con.serv = cgwc.getService("atendimento.Manager", new NS_Result(con));	application.acceptConnection(con);	//application.usersSo.setProperty(con.name, userName);};application.onDisconnect = function(con) {	con.serv.encerraAtendimento(con);	trace("\n:: Usuario desconectado: nome: " + con.name);	application.usersSo.setProperty(con.name, null);	application.usersSoAtendimento.setProperty(con.name, null);	con.close;};// SERVICOS REMOTOSfunction NS_Result(con) {	this.con = con;		this.onResult = function(result) {		trace("\n:: Dados recebidos no servidor : "+result);	};	this.onStatus = function(error) {		trace("\n:: Erro : "+error.description);	};	}// SERVICOSClient.prototype.encerraAtendimento = function(obj){	application.onDisconnect(obj);	trace("Atendente finaliza atendimento manual...\n");}NS_Result.prototype.encerraAtendimento_Result = function(objeto) {	this.con.call("encerraAtendimento_Result", null, objeto);			};Client.prototype.iniciaFila = function(obj) {		trace("\n:: iniciaFila-> Usuario entrando na fila...");	this.serv.iniciaFila(obj);};NS_Result.prototype.iniciaFila_Result = function(objeto) {		trace("\n:: iniciaFila_Result-> Usuario: "+ objeto['email'] +" -> "+objeto['cliente']);		application.usersSo.setProperty(objeto['email'], objeto);		this.con.call("iniciaFila_Result", null, objeto);		application.usersSoAtendimento = SharedObject.get(objeto['email'], objeto);		};Client.prototype.loginAtendente = function(obj) {	this.serv.loginAtendente(obj);	trace("\n:: Atendente logando... obj:" + obj['email']);};NS_Result.prototype.loginAtendente_Result = function(objeto) {	this.con.call("loginAtendente_Result", null, objeto);	trace("\n:: Atendente logado. obj: "+objeto['email']);};Client.prototype.iniciaAtendimento = function(obj) {	this.serv.iniciaAtendimento(obj);	trace("\n:: inicia atendimento:" + obj['email']);};NS_Result.prototype.iniciaAtendimento_Result = function(objeto) {	trace("\n:: inicia atendimento returno amf . obj: "+objeto['email']);		application.usersSo.setProperty(objeto['email'], objeto);	this.con.call("iniciaAtendimento_Result", null, objeto);	};